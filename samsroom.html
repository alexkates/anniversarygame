<html>
<head>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
</head>
<body onload="start()">
	<canvas id="graphics" style="position:absolute; top:0; left:0; border:solid;"></canvas>
</body>
</html>

<script>
var canvas_width = 400;
var canvas_height = 300;
var step = 10;

var sam_down = "content/sam/front.png";
var sam_right = "content/sam/right.png";
var sam_left = "content/sam/left.png";
var sam_up = "content/sam/back.png";
var sam_bed = "content/furnature/sam_bed.png";
var sam_dresser = "content/furnature/sam_dresser.png"

var sam = new object(
	new point(step,step),
	new point(23,0),
	new point(0,42), 
	new point(23,42),
	sam_down);
	
var sam_bed = new object(
	new point (step,canvas_height/2),
	new point (50,canvas_height/2),
	new point (0,canvas_height/2 + 64),
	new point (50,canvas_height/2 + 64),
	sam_bed);
	
var sam_dresser = new object(
	new point(canvas_width-75, canvas_height/2),
	new point(canvas_width, canvas_height/2),
	new point(canvas_width-75, canvas_height/2),
	new point(canvas_width, canvas_height/2),
	sam_dresser);	
	
var bounds = new object(
	new point (0,0),
	new point (canvas_width, 0),
	new point (0, canvas_height),
	new point (canvas_width, canvas_height));

window.addEventListener('keydown',doKeyDown,true);

///////////////////
// end script
///////////////////

function point(x, y) {
	this.x = x;
	this.y = y;
	
	this.toString = function() {
		return "(" + this.x + ", " + this.y + ")";
	}
}

function object(topLeft, topRight, bottomLeft, bottomRight, img) {
	this.topLeft = topLeft;
	this.topRight = topRight;
	this.bottomLeft = bottomLeft;
	this.bottomRight = bottomRight;
	this.img = img;
	
	this.moveRight = function(step) {
		this.topLeft.x += step;
		this.topRight.x += step;
		this.bottomLeft.x += step;
		this.bottomRight.x += step;
	}
	
	this.moveLeft = function(step) {
		this.topLeft.x -= step;
		this.topRight.x -= step;
		this.bottomLeft.x -= step;
		this.bottomRight.x -= step;
	}
	
	this.moveDown = function(step) {
		this.topLeft.y += step;
		this.topRight.y += step;
		this.bottomLeft.y += step;
		this.bottomRight.y += step;
	}
	
	this.moveUp = function(step) {
		this.topLeft.y -= step;
		this.topRight.y -= step;
		this.bottomLeft.y -= step;
		this.bottomRight.y -= step;
	}
	
	this.willLeaveUp = function(box, step) {
		return this.topRight.y - step <= box.topLeft.y;		
	}
	
	this.willLeaveLeft = function(box, step) {
		return this.bottomLeft.x - step <= box.topLeft.x;
	}
	
	this.willLeaveRight = function(box, step) {
		return this.topRight.x + step >= box.bottomRight.x;
	}
	
	this.willLeaveDown = function(box, step) {
		return this.bottomLeft.y + step >= box.bottomLeft.y;
	}
	
	this.willCollideRight = function(other, step) {
		return (
			(this.topRight.y <= other.topLeft.y && this.bottomRight.y >= other.topLeft.y) || 
			(this.topRight.y <= other.bottomLeft.y && this.bottomRight.y >= other.bottomLeft.y) && 
			 this.topRight.x + step <= other.bottomLeft.x
		); 
	}
	
	this.willCollideDown = function(other, step) {
		return (
			(this.bottomLeft.x <= other.topLeft.x && this.bottomRight.x >= other.topLeft.x) || 
			(this.bottomLeft.x <= other.topRight.x && this.bottomRight.x >= other.topRight.x) && 
			 this.bottomRight.y + step <= other.topRight.y
		); 
	}
	
	this.toString = function() {
		return "top left: " + this.topLeft.toString() + "\n" + 
			   "top right: " + this.topRight.toString() + "\n" +
			   "bottom left: " + this.bottomLeft.toString() + "\n" + 
			   "bottom right: " + this.bottomRight.toString() + "\n";
	}
}

function doKeyDown(e) {
		var code = e.keyCode ? e.keyCode : e.which;
		switch (code) {
		case 87: //w
			sam.img = sam_up;
			if(!sam.willLeaveUp(bounds, step))
				sam.moveUp(step);
		break;
		case 65: //a
			sam.img = sam_left;
			if(!sam.willLeaveLeft(bounds, step))
				sam.moveLeft(step);
		break;
		case 83: //s
			sam.img = sam_down;
			if(!sam.willLeaveDown(bounds, step))
				sam.moveDown(step);
		break;
		case 68: //d
			sam.img = sam_right;
			if(!sam.willLeaveRight(bounds, step))
				sam.moveRight(step);
		break; 
	}
}

function start() {
	setInterval(update,1000/15);
}

function update() {
	clear();
	draw();
}

function draw() {
	drawImage(sam_bed.img, sam_bed.topLeft.x, sam_bed.topLeft.y);
	drawImage(sam_dresser.img, sam_dresser.topLeft.x, sam_dresser.topLeft.y);
	drawImage(sam.img, sam.topLeft.x, sam.topLeft.y);
}

function clear() {
	var canvas = document.getElementById("graphics");
	canvas.height = canvas_height;
	canvas.width = canvas_width;
	var context = canvas.getContext("2d");
	context.clearRect(0,0,canvas.width,canvas.height);
}

function drawImage(imgSrc, imgX, imgY) {
	var canvas = document.getElementById("graphics");
	canvas.height = canvas_height;
	canvas.width = canvas_width;
	var context = canvas.getContext("2d");

	var img = new Image();
	img.onload = function () {
		context.drawImage(img, imgX, imgY);
	}
	img.src = imgSrc;
}
</script>